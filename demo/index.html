<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>angular widget</title>
    <script src="https://cdn.bootcss.com/angular.js/1.4.6/angular.min.js"></script>
</head>
<style type="text/css">
	.time-box{
        width: 600px;
        height: 30px;
        background: gray;
        position: relative;
    }
    .time-range {
        display: inline-block;
        height: 100%;
        background: green;
        position: absolute;
    }
</style>
<body ng-app="myApp">
    <h1>主页面</h1>
    <div ng-controller="ctrl">
        <cctv-time-bar></cctv-time-bar>
    </div>
</body>
</html>
<!--<script src="timebar.js" type="text/javascript" charset="utf-8"></script>-->
<script>
    var app = angular.module('myApp',[]);
    app.directive('cctvTimeBar',function () {
        return{
            restrict: 'ECAM',
            templateUrl:'timebardemo.html',
            scope: {
            	presentTime: '='
            },
            replace: true,
            controller: function ($scope) {
            	var timeArr = [['2017-12-10 02:22:08','2017-12-10 05:00:00'],['2017-12-10 				07:22:08','2017-12-10 09:00:00'],['2017-12-10 10:22:08','2017-12-10 				12:00:00'],['2017-12-10 12:30:20','2017-12-10 13:00:20'],['2017-12-10 				13:30:20','2017-12-10 14:30:20'],['2017-12-10 14:30:20','2017-12-10 				15:30:20'],['2017-12-10 15:30:20','2017-12-10 23:59:59']];
			    var spanprop = [];
			    var start = '2017-12-10 00:00:00';
			    var date0 = new Date(start);
			    var curentDate;
			    $scope.xxx;
			    var parentNode = document.querySelector('.time-box');
			    timeArr.forEach(function (item) {
			        var date1 = new Date(item[1]);
			        var date2 = new Date(item[0]);
			        var s = (date1.getTime() - date2.getTime()) / (24*60*60*1000);
			        var l = (date2.getTime() - date0.getTime()) / (24*60*60*1000);
			        spanprop.push({
			            s:s * 600,
			            l:l * 600
			        })
			    })

			    spanprop.forEach(function(obj){
			        var spanEle = document.createElement('span');
			        spanEle.className = 'time-range';
			        spanEle.style.width = obj.s + 'px';
			        spanEle.style.left = obj.l + 'px';
			        parentNode.appendChild(spanEle);
			    })
			    parentNode.onmouseover = function (e) {
			        var eve = e || window.event;
			        var x;
			        if(eve.target.nodeName == 'SPAN') {
			            x = eve.offsetX + eve.target.offsetLeft;    
			        }else{
			            x = eve.offsetX;
			        }
			        var currentS = (x*24*60*60*1000 / 600) + date0.getTime();
			        curentDate = new Date(currentS);
			        $scope.xxx = translate(curentDate);
			        console.log($scope.xxx);
			    }

			    function translate(time){
			        var y = time.getFullYear();
			        var m = time.getMonth() + 1;
			        var d = time.getDate();
			        var h = time.getHours();
			        var f = time.getMinutes();
			        var s = time.getSeconds();
			        var newDate = y + '-' +  cuve(m) + '-' + cuve(d) + ' ' + cuve(h) + ':' + 					cuve(f) + ':' + cuve(s);
			        return newDate;
			    }
    
			    function cuve(type) {
			        if (type < 10) {
			            type = '0' + type;
			        }
			        return type;
			    }
			    $scope.$watch('xxx', function (old,ne) {
			    	console.log(old,ne)
			    })
			}
        }
    })
    app.controller('ctrl',['$scope',function ($scope){
        // 
    }])
</script>